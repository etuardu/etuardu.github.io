<!DOCTYPE html>
<html lang="en" class="no-js"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><link rel="alternate" type="application/rss+xml" title="" href="https://etuardu.github.io/feed.xml"><link rel="icon" href="/images/favicon.png" type="image/png"><title>I turned a legacy dictionary software into a Telegram bot: hVortaroBot - etuardu</title><link rel="canonical" href="https://etuardu.github.io/posts/hvortaro-telegram-bot/"><meta property="og:site_name" content="etuardu"><meta property="og:title" content="I turned a legacy dictionary software into a Telegram bot: hVortaroBot - etuardu"><meta property="og:type" content="website"><meta property="og:url" content="https://etuardu.github.io/posts/hvortaro-telegram-bot/"><meta name="twitter:creator" content="@etuardu"><script>document.documentElement.classList.remove('no-js');</script><style>*{box-sizing:border-box}:after,:before{box-sizing:inherit}body,dd,dl,dt,figcaption,figure,h1,h2,h3,h4,li,ol,p,ul{margin:0;padding:0}body{-ms-overflow-style:-ms-autohiding-scrollbar;scroll-behavior:smooth;font-size:1rem;min-height:100vh}ol[class],ul[class]{list-style:none}a:not([class]){text-decoration:underline;text-decoration-skip-ink:auto;cursor:pointer}input::-webkit-input-placeholder,select::-webkit-input-placeholder,textarea::-webkit-input-placeholder{line-height:normal}img{max-width:100%}@media(prefers-reduced-motion:reduce){*{-webkit-animation:none!important;animation:none!important;transition:none!important;scroll-behavior:auto!important}}.sf-flow{--flow-space:1em}.sf-flow>*+*{margin-top:1em;margin-top:var(--flow-space)}.align-start{align-items:flex-start}.align-center{align-items:center}.align-end{align-items:flex-end}.bg-primary{background:#173854}.bg-primary-shade{background:#102538}.bg-primary-glare{background:#22547c}.bg-highlight{background:#fedb8b}.bg-light{background:#fff}.bg-mid{background:#ccc}.bg-dark{background:#333}.bg-slate{background:#404040}.color-primary{color:#173854}.color-primary-shade{color:#102538}.color-primary-glare{color:#22547c}.color-highlight{color:#fedb8b}.color-light{color:#fff}.color-mid{color:#ccc}.color-dark{color:#333}.color-slate{color:#404040}.box-block{display:block}.box-flex{display:flex}.box-inline-flex{display:inline-flex}.box-hide{display:none}.font-base{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol'}.font-serif{font-family:Lora,serif}.gap-top-300{margin-top:.8rem}.gap-top-500{margin-top:1.25rem}.gap-top-600{margin-top:1.56rem}.gap-top-700{margin-top:1.95rem}.gap-top-800{margin-top:2.44rem}.gap-top-900{margin-top:3.05rem}.gap-top-base{margin-top:1rem}.gap-top-max{margin-top:4rem}.gap-bottom-300{margin-bottom:.8rem}.gap-bottom-500{margin-bottom:1.25rem}.gap-bottom-600{margin-bottom:1.56rem}.gap-bottom-700{margin-bottom:1.95rem}.gap-bottom-800{margin-bottom:2.44rem}.gap-bottom-900{margin-bottom:3.05rem}.gap-bottom-base{margin-bottom:1rem}.gap-bottom-max{margin-bottom:4rem}.leading-tight{line-height:1.2}.leading-mid{line-height:1.5}.leading-loose{line-height:1.7}.measure-long{max-width:75ch}.measure-short{max-width:60ch}.measure-compact{max-width:40ch}.pad-top-300{padding-top:.8rem}.pad-top-500{padding-top:1.25rem}.pad-top-600{padding-top:1.56rem}.pad-top-700{padding-top:1.95rem}.pad-top-800{padding-top:2.44rem}.pad-top-900{padding-top:3.05rem}.pad-top-base{padding-top:1rem}.pad-top-max{padding-top:4rem}.pad-bottom-300{padding-bottom:.8rem}.pad-bottom-500{padding-bottom:1.25rem}.pad-bottom-600{padding-bottom:1.56rem}.pad-bottom-700{padding-bottom:1.95rem}.pad-bottom-800{padding-bottom:2.44rem}.pad-bottom-900{padding-bottom:3.05rem}.pad-bottom-base{padding-bottom:1rem}.pad-bottom-max{padding-bottom:4rem}.pad-left-300{padding-left:.8rem}.pad-left-500{padding-left:1.25rem}.pad-left-600{padding-left:1.56rem}.pad-left-700{padding-left:1.95rem}.pad-left-800{padding-left:2.44rem}.pad-left-900{padding-left:3.05rem}.pad-left-base{padding-left:1rem}.pad-left-max{padding-left:4rem}.space-between{justify-content:space-between}.space-around{justify-content:space-around}.space-before{justify-content:flex-end}.stack-300{z-index:0}.stack-400{z-index:10}.stack-500{z-index:20}.stack-600{z-index:30}.stack-700{z-index:40}.ta-right{text-align:right}.ta-left{text-align:left}.ta-center{text-align:center}.text-300{font-size:.8rem}.text-500{font-size:1.25rem}.text-600{font-size:1.56rem}.text-700{font-size:1.95rem}.text-800{font-size:2.44rem}.text-900{font-size:3.05rem}.text-base{font-size:1rem}.text-max{font-size:4rem}.weight-light{font-weight:300}.weight-regular{font-weight:400}.weight-mid{font-weight:600}.weight-bold{font-weight:700}.width-full{width:100%}.width-half{width:50%}.width-quarter{width:25%}.width-third{width:33.3333333333%}@media screen and (min-width:48rem){.md\:align-start{align-items:flex-start}.md\:align-center{align-items:center}.md\:align-end{align-items:flex-end}.md\:box-block{display:block}.md\:box-flex{display:flex}.md\:box-inline-flex{display:inline-flex}.md\:box-hide{display:none}.md\:space-between{justify-content:space-between}.md\:space-around{justify-content:space-around}.md\:space-before{justify-content:flex-end}.md\:ta-right{text-align:right}.md\:ta-left{text-align:left}.md\:ta-center{text-align:center}.md\:text-300{font-size:.8rem}.md\:text-500{font-size:1.25rem}.md\:text-600{font-size:1.56rem}.md\:text-700{font-size:1.95rem}.md\:text-800{font-size:2.44rem}.md\:text-900{font-size:3.05rem}.md\:text-base{font-size:1rem}.md\:text-max{font-size:4rem}.md\:width-full{width:100%}.md\:width-half{width:50%}.md\:width-quarter{width:25%}.md\:width-third{width:33.3333333333%}}:root{--color-primary:#173854;--color-primary-shade:#102538;--color-primary-glare:#22547c;--color-highlight:#fedb8b;--color-light:#ffffff;--color-mid:#cccccc;--color-dark:#333333;--color-slate:#404040;--color-mode:"light";--color-bg:#ffffff;--color-bg-glare:#ffffff;--color-text:#333333;--color-text-glare:#333333;--color-selection-text:#ffffff;--color-selection-bg:#333333;--color-stroke:#cccccc;--color-action-bg:#173854;--color-action-text:#ffffff;--color-theme-primary:#173854;--color-theme-primary-glare:#22547c;--color-theme-highlight:#fedb8b;--color-theme-highlight-block:#fedb8b}@media(prefers-color-scheme:dark){:root{--color-mode:"dark"}:root:not([data-user-color-scheme]){--color-bg:#333333;--color-bg-glare:#404040;--color-text:#ffffff;--color-selection-text:#333333;--color-selection-bg:#ffffff;--color-stroke:#404040;--color-theme-primary:#8bb8df;--color-theme-primary-glare:#b3d2ea;--color-action-bg:var(--color-theme-primary-glare);--color-action-text:#333333;--color-theme-highlight:#fedb8b;--color-theme-highlight-block:#404040;--color-theme-feature-text:#fedb8b}}[data-user-color-scheme=dark]{--color-bg:#333333;--color-bg-glare:#404040;--color-text:#ffffff;--color-selection-text:#333333;--color-selection-bg:#ffffff;--color-stroke:#404040;--color-theme-primary:#8bb8df;--color-theme-primary-glare:#b3d2ea;--color-action-bg:var(--color-theme-primary-glare);--color-action-text:#333333;--color-theme-highlight:#fedb8b;--color-theme-highlight-block:#404040;--color-theme-feature-text:#fedb8b}body{color:var(--color-text);background-color:var(--color-bg)}main{overflow:hidden}::selection{color:var(--color-selection-text);background-color:var(--color-selection-bg)}@font-face{font-family:Lora;font-style:normal;font-weight:700;font-display:swap;src:local("Lora Bold"),local("Lora-Bold"),url(/fonts/lora-v13-latin-700.woff) format("woff")}body{line-height:1.56;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol'}h1,h2,h3{font-family:Lora,serif}h1{font-size:1.95rem}h2{font-size:1.56rem}h3{font-size:1.25rem}@media(min-width:48rem){h1{font-size:3.05rem}h2{font-size:2.44rem}h3{font-size:1.95rem}}body,html{height:100%}body{scroll-behavior:smooth;display:flex;flex-direction:column}main{flex:1 0 auto}main:focus{outline:0}hr{display:block;height:1px;max-width:500px;background:var(--color-stroke);border:none;margin:3.05rem auto}img{height:auto}:focus{outline:1px solid var(--color-theme-primary-glare);outline-offset:.25rem}.inner-wrapper{max-width:52rem;margin-left:auto;margin-right:auto;padding-left:1.25rem;padding-right:1.25rem}.post__footer h2 a,.skip-link:not(:focus),.visually-hidden{border:0;clip:rect(0 0 0 0);height:auto;margin:0;overflow:hidden;padding:0;position:absolute;width:1px;white-space:nowrap}.wrapper{max-width:58rem;margin-left:auto;margin-right:auto;padding-left:1.25rem;padding-right:1.25rem}.button{display:inline-block;border:none;background-color:var(--color-action-bg);color:var(--color-action-text);padding:.8rem 1rem;line-height:1;margin:0;text-decoration:none;cursor:pointer;-webkit-appearance:none;-moz-appearance:none}.button:focus,.button:hover{filter:brightness(1.2)}.button:focus:hover{outline:0}.button:focus:not(:hover){outline:1px solid var(--color-action-text);outline-offset:-4px}.button:active{transform:scale(.99)}form{max-width:35rem}form br{display:none}label{display:block;font-weight:600}input,select{line-height:1}input,select,textarea{background-color:#fff;font:inherit;border:1px solid var(--color-text);margin-top:.15rem;padding:.5rem 1rem;width:100%;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol'}label input{margin:-.25rem .5rem 0 0;width:auto;vertical-align:middle}fieldset{border:0;margin:0;padding:0}legend{display:block;font-weight:700}.field-list{margin:0;padding:0;list-style:none}.field-list__field-group{margin-bottom:2rem;transition:transform 150ms}.field-list__field-group__description{display:block;margin-top:.3rem;font-size:.875rem;line-height:1.25}textarea+.field-list__field-group__description{margin-top:0}.field-list__field-group--confirm{font-weight:400}.field-list__field-group__list{list-style:none;margin:0}.field-list__field-group__list label{font-weight:400}.field-list__field-group__list .field-list__field-group__description{margin:0 0 0 1.35rem}.heading-permalink{color:var(--color-theme-primary-glare);font-size:.8em;margin-left:.3em;margin-top:.2em}@media(min-width:48rem){.heading-permalink{font-size:.6em;margin-top:.4em}}.intro{background:var(--color-theme-highlight-block)}.intro__summary{--flow-space:1.25rem;font-size:1.25rem}.intro__summary a{color:currentColor}.intro__summary a:hover{text-decoration:none}.intro__heading{max-width:40ex;color:var(--color-theme-feature-text)}.intro__heading--compact{max-width:20ex}.nav__list{overflow-x:auto;padding:.5rem;margin:-.5rem;-webkit-overflow-scrolling:touch;-ms-overflow-style:none}.nav__list::-webkit-scrollbar{display:none}.nav__list>*+*{margin-left:1.25rem}.nav__item{padding:.8rem 0;flex-shrink:0}.nav__item a{color:currentColor;font-weight:600}.nav__item a:not(:hover){text-decoration:none}.pagination{flex-wrap:wrap}.pagination a{color:var(--color-theme-primary)}.pagination a:not(:hover){text-decoration:none}.pagination a[data-direction=backwards]{flex-direction:row-reverse}.pagination a[data-direction=backwards] svg{transform:rotate(-180deg)}.pagination a[data-direction=forwards]:only-child{margin-left:auto}.pagination svg{pointer-events:none}.post__body{--flow-space:2.44rem}.post__body h2+*,.post__body h3+*{--flow-space:1.25rem}.post__body h2,.post__body h3{position:relative;line-height:1.2}.post__body a:not([class]){color:var(--color-dark);position:relative;display:inline-block;background:var(--color-theme-highlight);padding:.2rem .4rem .3rem .4rem;text-decoration:none;word-break:break-word;line-height:1.2}.post__body a:not([class]):hover{text-decoration:underline}.post__body code{font-size:1.2em;color:var(--color-theme-primary);font-weight:600;margin-left:.01ch;margin-right:.01ch}.post__body pre>code{margin-right:0;border:1px solid rgba(255,255,255,.1);overflow-x:auto;-webkit-overflow-scrolling:touch}.post__body blockquote{border-left:.4rem solid var(--color-theme-primary-glare);margin-left:0;padding-left:1.25rem;font-style:italic;font-size:1.56rem}.post__body blockquote p{opacity:.85;padding:1.25rem 0}.post__body ol:not([class]),.post__body ul:not([class]){margin-left:2.44rem}.post__body ol:not([class]) li+li,.post__body ul:not([class]) li+li{margin-top:.8rem}.post__body .video-player,.post__body .video-player+*,.post__body figure,.post__body figure+*,.post__body pre>code,.post__body video{--flow-space:4rem}.post__body .video-player,.post__body figure,.post__body pre>code,.post__body video{width:100vw;max-width:58rem;margin-left:50%;transform:translateX(-50%);position:relative}.post__body .video-player,.post__body figure img,.post__body pre>code{box-shadow:0 10px 30px rgba(0,0,0,.15)}.post__body figure img{position:relative;z-index:1}.post__body figcaption{font-size:.8em;font-style:italic;max-width:52rem;margin:.5rem auto 0 auto;padding:0 1.25rem}.post__body pre>code{display:block;background:var(--color-dark);padding:1.95rem;font-size:1.25rem}.post__footer{background:var(--color-theme-highlight)}.post__footer h2{flex-shrink:0;margin-right:1rem;color:var(--color-dark)}.post__footer a{background:var(--color-bg);padding:.4rem .6rem}.post-list__item{--flow-space:1.95rem}.post-list__link,.post-list__link:visited{color:var(--color-theme-primary);text-decoration:none}.post-list__link:hover{text-decoration:underline}.site-head__site-name{font-weight:700;text-decoration:none;color:var(--color-text)}.site-foot{background:var(--color-bg-glare);color:var(--color-text);border-top:1px solid var(--color-stroke)}.site-foot a{color:currentColor}.site-foot a:hover{text-decoration:none}.site-foot__credit{text-align:center}.skip-link:focus{display:inline-block;position:absolute;top:0;left:0;padding:.8rem 1.25rem 1rem 1.25rem;background-color:var(--color-action-bg);color:var(--color-action-text);line-height:1;text-decoration:none;font-weight:700}code[class*=language-],pre[class*=language-]{color:#f8f8f2;background:0 0;font-family:Consolas,Monaco,"Andale Mono","Ubuntu Mono",monospace;text-align:left;word-spacing:normal;word-break:normal;word-wrap:normal;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#d4d0ab}.token.punctuation{color:#fefefe}.token.constant,.token.deleted,.token.property,.token.symbol,.token.tag{color:#ffa07a}.token.boolean,.token.number{color:#00e0e0}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#abe338}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#00e0e0}.token.atrule,.token.attr-value,.token.function{color:gold}.token.keyword{color:#00e0e0}.token.important,.token.regex{color:gold}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}@media screen and (-ms-high-contrast:active){code[class*=language-],pre[class*=language-]{color:windowText;background:window}:not(pre)>code[class*=language-],pre[class*=language-]{background:window}.token.important{background:highlight;color:window;font-weight:400}.token.atrule,.token.attr-value,.token.function,.token.keyword,.token.operator,.token.selector{font-weight:700}.token.attr-value,.token.comment,.token.doctype,.token.function,.token.keyword,.token.operator,.token.property,.token.string{color:highlight}.token.attr-value,.token.url{font-weight:400}}.video-player{position:relative;padding-top:56.25%}.video-player>iframe{position:absolute;top:0;left:0;width:100%;height:100%}.post .video-player{padding-top:63%}@media(min-width:48rem){.post .video-player{padding-top:66%}}.round-photo{width:200px;height:200px;position:relative}.round-photo img{width:100%;border-radius:50%}.round-photo::after{position:absolute;top:0;left:0;width:100%;height:100%;border-radius:50%;display:block;content:"";box-shadow:inset -5px 5px 7px rgba(0,0,0,.2);pointer-events:none}</style></head><body><a class="skip-link" href="#main-content">Skip to content</a><header role="banner" class="[ site-head ] [ pad-top-700 pad-bottom-700"><div class="wrapper"><div class="[ site-head__inner ] [ md:box-flex space-between align-center ]"><a href="/" class="[ site-head__site-name ] [ leading-tight ]"><span class="visually-hidden">etuardu - Home</span> <span class="[ site-head__site-name ] [ text-600 ]" aria-hidden="true">etuardu</span></a><nav class="nav" aria-label="navigation"><ul class="[ nav__list ] [ box-flex align-center md:space-before ]"><li class="nav__item"><a href="/">Home</a></li><li class="nav__item"><a href="/about-me">About me</a></li></ul></nav></div></div></header><main id="main-content" tabindex="-1"><article class="[ post ] [ h-entry ]"><header class="[ intro ] [ pad-top-900 pad-bottom-max ]"><div class="[ inner-wrapper ] [ sf-flow ]"><h1 class="[ intro__heading ] [ text-800 md:text-900 leading-tight ] [ p-name ]">I turned a legacy dictionary software into a Telegram bot: hVortaroBot</h1><div class="[ intro__summary ] [ sf-flow ] [ leading-mid measure-short ]"><p class="[ intro__meta ] [ text-500 leading-tight ]"><time datetime="2020-04-21T00:00:00.000Z" class="dt-published">21st April 2020</time> <span>— 9 minute read</span></p></div></div></header><div class="[ post__body ] [ inner-wrapper ] [ leading-loose pad-top-900 text-500 ] [ sf-flow ] [ e-content ]"><p><img src="/images/hvortaro.png" alt="" loading="lazy" width="830" height="447"></p><blockquote>I had fun reverse engineering the dictionary data and adding some word guessing games!</blockquote><hr><h1>hVortaro</h1><p>The dictionary is called <a href="http://www.esperanto.it/hvortaro">hVortaro</a>, it is an Italian-Esperanto dictionary and is available in both a web version and a desktop version.</p><p>To build the Telegram bot, I decided to use the dictionary data which comes with the desktop version, so I downloaded it from <a href="http://www.esperanto.it/hvortaro/programo.php">this page</a>, where the publisher, quite conveniently, also provides links to download only the data files without the application.</p><p>The zip file I download contained two files with not well known extensions, so I used the <code>file</code> command to try to determine the file types:</p><pre class="language-bash"><code class="language-bash"><span class="highlight-line">$ <span class="token function">file</span> itaesps.*</span><br><span class="highlight-line">itaesps.bin: data</span><br><span class="highlight-line">itaesps.idx: data</span></code></pre><p>Unfortunately it didn't help much, so further investigation was required.</p><p>I noticed that the file <code>itaesps.idx</code> (1.8 Mb) was much smaller than <code>itaesps.bin</code> (9.2 Mb). Both its size and extension suggested that it may be an index, and this can be confirmed looking for readable text in it:</p><pre class="language-bash"><code class="language-bash"><span class="highlight-line">$ strings itaesps.idx <span class="token operator">|</span> <span class="token function">less</span></span><br><span class="highlight-line">La divinis<span class="token operator">|</span></span><br><span class="highlight-line">a fortiori<span class="token operator">|</span></span><br><span class="highlight-line">a gogo<span class="token operator">|</span></span><br><span class="highlight-line">a jour<span class="token operator">|</span></span><br><span class="highlight-line">Aa la belle etoile<span class="token operator">|</span></span><br><span class="highlight-line">oa la coque<span class="token operator">|</span></span><br><span class="highlight-line">a la page<span class="token operator">|</span></span><br><span class="highlight-line">Wa latere<span class="token operator">|</span></span><br><span class="highlight-line">…</span></code></pre><p>This appears to be a list of terms: <em>a divinis, a fortiori, a gogo, a la belle etoile, a la coque, a la pace, a latere</em>…</p><p>On the other hand, <code>itaesps.bin</code> contains the definitions, starting with the one for the term <em>a</em>:</p><pre class="language-bash"><code class="language-bash"><span class="highlight-line">$ strings itaesps.bin <span class="token operator">|</span> <span class="token function">less</span></span><br><span class="highlight-line">a <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token comment">#</span></span><br><span class="highlight-line">s.f.</span><br><span class="highlight-line">a come Adamo</span><br><span class="highlight-line">a kiel Adamo<span class="token comment">#</span></span><br><span class="highlight-line">dall'a alla zeta</span><br><span class="highlight-line">de a</span><br><span class="highlight-line">is zo<span class="token comment">#</span></span><br><span class="highlight-line">a <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token comment">#</span></span><br><span class="highlight-line">prep.<span class="token comment">#</span></span><br><span class="highlight-line"><span class="token punctuation">(</span>compl. di termine<span class="token punctuation">)</span></span><br><span class="highlight-line">parla a tuo padre</span><br><span class="highlight-line">parolu al via patro<span class="token comment">#</span></span><br><span class="highlight-line">…</span></code></pre><h2 id="heading-decoding-the-index">Decoding the index<a href="#heading-decoding-the-index" class="heading-permalink"><span class="visually-hidden"> permalink</span><svg fill="currentColor" aria-hidden="true" focusable="false" width="1em" height="1em" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h2><p>Going back to <code>itaesps.idx</code> and inspecting its content:</p><pre class="language-bash"><code class="language-bash"><span class="highlight-line">$ hexdump <span class="token parameter variable">-C</span> itaesps.idx <span class="token operator">|</span> <span class="token function">less</span></span><br><span class="highlight-line">00000000  <span class="token number">23</span> 00 00 00 01 <span class="token number">61</span> 7c a3  00 00 1b 4c <span class="token number">61</span> <span class="token number">20</span> <span class="token number">64</span> <span class="token number">69</span>  <span class="token operator">|</span><span class="token comment">#....a|....La di|</span></span><br><span class="highlight-line">00000010  <span class="token number">76</span> <span class="token number">69</span> 6e <span class="token number">69</span> <span class="token number">73</span> 7c a3 00  00 1b ba <span class="token number">61</span> <span class="token number">20</span> <span class="token number">66</span> 6f <span class="token number">72</span>  <span class="token operator">|</span>vinis<span class="token operator">|</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.a <span class="token keyword">for</span><span class="token operator">|</span></span><br><span class="highlight-line">00000020  <span class="token number">74</span> <span class="token number">69</span> 6f <span class="token number">72</span> <span class="token number">69</span> 7c a3 00  00 1b eb <span class="token number">61</span> <span class="token number">20</span> <span class="token number">67</span> 6f <span class="token number">67</span>  <span class="token operator">|</span>tiori<span class="token operator">|</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.a gog<span class="token operator">|</span></span><br><span class="highlight-line">00000030  6f 7c a3 00 00 1c 1c <span class="token number">61</span>  <span class="token number">20</span> 6a 6f <span class="token number">75</span> <span class="token number">72</span> 7c a3 00  <span class="token operator">|</span>o<span class="token operator">|</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.a jour<span class="token operator">|</span><span class="token punctuation">..</span><span class="token operator">|</span></span><br><span class="highlight-line">…</span><br><span class="highlight-line">001b3030  a3 00 <span class="token number">92</span> b1 1d 7a <span class="token number">75</span> <span class="token number">72</span>  <span class="token number">69</span> <span class="token number">67</span> 6f 7c 5e 00 <span class="token number">92</span> b1  <span class="token operator">|</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.zurigo<span class="token operator">|</span>^<span class="token punctuation">..</span>.<span class="token operator">|</span></span><br><span class="highlight-line">001b3040  <span class="token number">40</span> 7a <span class="token number">75</span> <span class="token number">72</span> <span class="token number">69</span> 6b 6f 7c  a3 00 <span class="token number">92</span> b1 <span class="token number">63</span> 7a <span class="token number">75</span> 7a  <span class="token operator">|</span>@zuriko<span class="token operator">|</span><span class="token punctuation">..</span><span class="token punctuation">..</span>czuz<span class="token operator">|</span></span><br><span class="highlight-line">001b3050  7a <span class="token number">65</span> <span class="token number">72</span> <span class="token number">65</span> 6c 6c 6f 6e  <span class="token number">65</span> 7c                    <span class="token operator">|</span>zerellone<span class="token operator">||</span></span></code></pre><p>One can notice that it starts with the term <em>a</em> and follows this pattern:</p><ul><li>Each term is followed by a pipe <code>|</code> (0x7c).</li><li>Each term is preceded by 5 bytes.</li></ul><p>Looking at the 5 byte block, it seems that its last 4 bytes contain an increasing value:</p><ul><li><code>00 00 00 01</code> — <em>a</em></li><li><code>00 00 1b 4c</code> — <em>a divinis</em></li><li><code>00 00 1b ba</code> — <em>a fortiori</em></li><li>…</li><li><code>00 92 b1 40</code> — <em>zuriko</em></li><li><code>00 92 b1 63</code> — <em>zuzzerellone</em></li></ul><p>Using this value as a byte offset for <code>itaesps.bin</code> the corresponding definitions are found. For example, for <em>a fortiori</em> (0x1bba):</p><pre class="language-bash"><code class="language-bash"><span class="highlight-line">$ hexdump <span class="token parameter variable">-C</span> itaesps.bin <span class="token parameter variable">-s</span> 0x1bba <span class="token operator">|</span> <span class="token function">less</span></span><br><span class="highlight-line">00001bba  00 2d 00 a4 <span class="token number">61</span> <span class="token number">20</span> <span class="token number">66</span> 6f  <span class="token number">72</span> <span class="token number">74</span> <span class="token number">69</span> 6f <span class="token number">72</span> <span class="token number">69</span> <span class="token number">23</span> ac  <span class="token operator">|</span>.-<span class="token punctuation">..</span>a fortiori<span class="token comment">#.|</span></span><br><span class="highlight-line">00001bca  <span class="token number">28</span> 6c <span class="token number">61</span> <span class="token number">74</span> 2e <span class="token number">29</span> <span class="token number">23</span> a7  6c 2e <span class="token number">61</span> <span class="token number">76</span> 2e b4 <span class="token number">64</span> <span class="token number">65</span>  <span class="token operator">|</span><span class="token punctuation">(</span>lat.<span class="token punctuation">)</span><span class="token comment">#.l.av..de|</span></span><br><span class="highlight-line">00001bda  <span class="token number">73</span> <span class="token number">20</span> <span class="token number">70</span> 6c <span class="token number">69</span> 2c b4 <span class="token number">74</span>  <span class="token number">69</span> 6f 6d <span class="token number">20</span> <span class="token number">70</span> 6c <span class="token number">69</span> <span class="token number">23</span>  <span class="token operator">|</span>s pli,.tiom pli<span class="token comment">#|</span></span><br><span class="highlight-line">00001bea  08 00 2d 00 a4 e0 <span class="token number">20</span> <span class="token number">67</span>  6f <span class="token number">67</span> 6f <span class="token number">23</span> ac <span class="token number">28</span> <span class="token number">66</span> <span class="token number">72</span>  <span class="token operator">|</span><span class="token punctuation">..</span>-<span class="token punctuation">..</span>. gogo<span class="token comment">#.(fr|</span></span><br><span class="highlight-line">00001bfa  2e <span class="token number">29</span> <span class="token number">23</span> a7 6c 2e <span class="token number">61</span> <span class="token number">76</span>  2e b4 <span class="token number">70</span> 6c <span class="token number">65</span> 6e <span class="token number">61</span> <span class="token number">62</span>  <span class="token operator">|</span><span class="token builtin class-name">.</span><span class="token punctuation">)</span><span class="token comment">#.l.av..plenab|</span></span><br><span class="highlight-line">00001c0a  <span class="token number">75</span> 6e <span class="token number">64</span> <span class="token number">65</span> 2c b4 <span class="token number">70</span> 6c  <span class="token number">65</span> 6a <span class="token number">61</span> <span class="token number">62</span> <span class="token number">75</span> 6e <span class="token number">64</span> <span class="token number">65</span>  <span class="token operator">|</span>unde,.plejabunde<span class="token operator">|</span></span><br><span class="highlight-line">…</span></code></pre><p>I used this information in my app to load the index in ram as a hash table (a python dictionary). Of course one could skip this file altogether and directly use the content of <code>itaesps.bin</code> to populate a database of some sort, but I preferred to use those files themselves as data source. This approach allows me to update the data just by replacing these two files with their eventual new version in the case of a dictionary upgrade.</p><h2 id="heading-decoding-the-content">Decoding the content<a href="#heading-decoding-the-content" class="heading-permalink"><span class="visually-hidden"> permalink</span><svg fill="currentColor" aria-hidden="true" focusable="false" width="1em" height="1em" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h2><p>First of all, I tried to detect the charset getting a chunk of text free from markup or control characters for inspection:</p><pre class="language-bash"><code class="language-bash"><span class="highlight-line">$ hexdump <span class="token parameter variable">-C</span> itaesps.bin <span class="token operator">|</span> <span class="token function">less</span></span><br><span class="highlight-line">…</span><br><span class="highlight-line">000dd680  e8 <span class="token number">20</span> <span class="token number">75</span> 6e <span class="token number">61</span> <span class="token number">20</span> <span class="token number">62</span> <span class="token number">65</span>  6c 6c e9 7a 7a <span class="token number">61</span> a5 <span class="token number">73</span>  <span class="token operator">|</span><span class="token builtin class-name">.</span> una bell.zza.s<span class="token operator">|</span></span><br><span class="highlight-line">000dd690  <span class="token number">75</span> <span class="token number">72</span> <span class="token number">20</span> 6c <span class="token number">61</span> <span class="token number">20</span> <span class="token number">61</span> 8b  <span class="token number">74</span> 6f <span class="token number">89</span> 6f <span class="token number">73</span> <span class="token number">65</span> 6f <span class="token number">20</span>  <span class="token operator">|</span>ur la a.to.oseo <span class="token operator">|</span></span><br><span class="highlight-line">000dd6a0  6f 6e <span class="token number">69</span> <span class="token number">20</span> 6b <span class="token number">75</span> <span class="token number">72</span> <span class="token number">61</span>  <span class="token number">73</span> <span class="token number">20</span> <span class="token number">70</span> 6c <span class="token number">65</span> 6e <span class="token number">83</span> <span class="token number">75</span>  <span class="token operator">|</span>oni kuras plen.u<span class="token operator">|</span></span><br><span class="highlight-line">000dd6b0  <span class="token number">65</span> <span class="token number">23</span> a9 <span class="token number">61</span> <span class="token number">20</span> <span class="token number">63</span> <span class="token number">61</span> <span class="token number">73</span>  <span class="token number">61</span> <span class="token number">20</span> <span class="token number">74</span> <span class="token number">75</span> <span class="token number">61</span> <span class="token number">20</span> <span class="token number">73</span> <span class="token number">69</span>  <span class="token operator">|</span>e<span class="token comment">#.a casa tua si|</span></span><br><span class="highlight-line">…</span></code></pre><p>Comparing this with the <a href="http://www.esperanto.it/hvortaro/trova.php?bellezza">web version</a> of the definition, I know that the text starting at 0xdd68f and ending at 0xdd6b1 should be decoded as <em>"sur la aŭtoŝoseo oni kuras plenĝue"</em>. This text is a good specimen because it contains several non ASCII characters (<em>ŭ</em>, <em>ŝ</em>, <em>ĝ</em>). I put this text in a new file and used the <code>file</code> command to detect its charset:</p><pre class="language-bash"><code class="language-bash"><span class="highlight-line">$ <span class="token function">dd</span> <span class="token assign-left variable">if</span><span class="token operator">=</span>itaesps.bin <span class="token assign-left variable">bs</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">skip</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span><span class="token number">0xdd68f</span><span class="token variable">))</span></span> <span class="token assign-left variable">count</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span><span class="token number">0xdd6b1</span> <span class="token operator">-</span> <span class="token number">0xdd68f</span><span class="token variable">))</span></span> <span class="token assign-left variable">of</span><span class="token operator">=</span>test.txt</span><br><span class="highlight-line"><span class="token number">34</span>+0 records <span class="token keyword">in</span></span><br><span class="highlight-line"><span class="token number">34</span>+0 records out</span><br><span class="highlight-line"><span class="token number">34</span> bytes copied, <span class="token number">0,00725953</span> s, <span class="token number">4,7</span> kB/s</span><br><span class="highlight-line">$ <span class="token function">file</span> <span class="token parameter variable">-i</span> test.txt</span><br><span class="highlight-line">test.txt: text/plain<span class="token punctuation">;</span> <span class="token assign-left variable">charset</span><span class="token operator">=</span>unknown-8bit</span></code></pre><p>Unfortunately, it seems that no standard charset was used, so I had to build a lookup table to decode the custom charset to utf-8. This was a bit tedious, but not hard. It was just a matter of comparing the encoded text with the one readable in the web version of the dictionary.</p><p>Decoding the rest of the format, such as control characters with special meanings (quotation, example, pronunciation, etc.), was done in the same way.</p><p>When I had what I needed to get the definitions for any desired terms, I wrapped everything in a python module and moved forward to build the bot.</p><h1>hVortaroBot</h1><p>To build the bot I used the <a href="https://github.com/python-telegram-bot/python-telegram-bot">python-telegram-bot</a> python library.</p><p>Apart from giving the definition for the prompted term, the bot supports the following commands:</p><ul><li><code>/casuale</code> — Get the definition of a random term</li><li><code>/impiccato</code> — Play the hangman</li><li><code>/quiz</code> — Play a trivia quiz</li><li><code>/annulla</code> — Cancel the running operation</li><li><code>/aiuto</code> — Get usage information</li></ul><p>Check it out here: <a href="https://t.me/hVortaroBot">@hVortaroBot</a></p><p>You can see the bot in action in this video:</p><div class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/YsFL2vvOgKw" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen=""></iframe></div><address rel="author" style="display:flex;align-items:center;font-style:unset"><div class="round-photo" style="width:60px;height:60px"><img src="/images/edoardo.jpeg" loading="lazy" width="436" height="436"></div><div class="nav__item" style="padding-left:1em"><a href="/about-me" class="color-slate text-base" style="opacity:.9">Edoardo Nannotti</a><p class="text-base" style="opacity:.7">Welcome! I'm Edoardo Nannotti, a software developer and designer based in Italy <i>[…]</i></p></div></address></div><aside class="[ post__body ] [ inner-wrapper ] [ pad-bottom-900 text-500 ]"></aside><ul class="[ nav__list ]" style="display:flex;justify-content:space-around;margin-bottom:40px"><li class="nav__item"><a href="/posts/cheating-in-a-drawing-game-using-python/">← Cheating in a drawing game with Python</a></li><li class="nav__item"><a href="/posts/cheating-in-a-word-game-using-python/">Cheating in a word game using Python →</a></li></ul><footer class="[ post__footer ] [ pad-top-500 pad-bottom-500 ]"><div class="inner-wrapper"><div class="[ nav ] [ box-flex align-center ]"><h2 class="font-base text-600 weight-mid" id="heading-filed-under">Filed under<a href="#heading-filed-under" class="heading-permalink"><span class="visually-hidden"> permalink</span><svg fill="currentColor" aria-hidden="true" focusable="false" width="1em" height="1em" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h2><ul class="[ nav__list ] [ box-flex align-center pad-left-400 ] [ p-category ]"><li class="nav__item"><a href="/tags/python">python</a></li></ul></div></div></footer></article></main><footer role="contentinfo" class="[ site-foot ] [ pad-top-700 pad-bottom-900 ]"><div class="wrapper"><div class="[ site-foot__inner ] [ md:box-flex space-between align-start ]"><div><article class="[ site-foot__details ] [ sf-flow measure-compact ]"><h2 class="font-base text-600">etuardu</h2><p>Personal blog of Edoardo Nannotti</p></article></div><div><nav class="nav" aria-label="footer navigation"><ul class="[ nav__list ] [ box-flex align-center md:space-before ]"><li class="nav__item"><a href="/">Home</a></li><li class="nav__item"><a href="/about-me">About me</a></li></ul></nav><theme-toggle></theme-toggle></div></div><p class="[ site-foot__credit ] [ pad-top-900 ]"><a href="https://creativecommons.org/licenses/by/4.0/" rel="external noreferer noopener" target="_blank">CC BY 4.0</a> Edoardo Nannotti. Powered <a href="https://www.11ty.dev/" rel="external noreferer noopener" target="_blank">11ty</a> and <a href="https://hylia.website" rel="external noopener noreferer" target="_blank">Hylia</a>.</p></div></footer><script type="module" src="/js/components/theme-toggle.js" async="" defer="defer"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/service-worker.js');
      });
    }</script><script src="https://identity.netlify.com/v1/netlify-identity-widget.js" defer="defer"></script></body></html>